---
title: "Investigation of Prisoner Population Statistics"
subtitle: "Presentation subtitle (if any)"
author: "YD_team <br> Cecilia, Frank, Junkai, Zhandos"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      
---

```{r install-package, include = FALSE, eval = FALSE}
# Copy and paste the following code into your console to download and install
# the `xaringan` package that contains all of the code which allows you 
# to create presentation slides in Rmarkdown
install.packages('xaringan')
```


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(janitor)
library(readr)

adjudications <- read_csv("data/CSV/AdjudicationsQ12023.csv")

 
adjudications <- adjudications %>%
  clean_names()

adjudications_clean <- adjudications %>%
  drop_na()


adjudications_clean <- adjudications_clean %>%
  rename(quarter = date)
```


```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here

```

```{r include=FALSE}

#Background image
style_xaringan(
  title_slide_background_image = "img/confetti.jpg"
)
```

class: center, middle

##The statement of the overall goal

1：What kinds of crimes are different age groups committing?

2：Is there any difference in length of punishments between males and females in different age groups?



---

class: inverse, center, middle

# Question:What kinds of crimes are different age groups committing?


---

# 


Question:

What kinds of crimes are different age groups committing?

introduction:

Understanding how offence patterns vary across age groups is important for identifying behavioural trends within prisons.
In the Adjudications dataset (Q1 2023), prisoners are classified into age groups, and each adjudication is associated with an offence category such as Disobedience/disrespect, Unauthorized transactions, or Violence.
This section examines which age groups are responsible for particular types of offences and whether certain offences are more common among specific age ranges.
---
class:middle, center
```{r, echo=FALSE, fig.align='center', out.width="60%"}
glimpse(adjudications_clean)
colSums(is.na(adjudications_clean))
```
---
```{r, echo=FALSE, fig.align='center', out.width="80%"}
library(tidyverse)
library(janitor)


adjudications_clean %>%
  group_by(offence) %>%
  summarise(total = sum(count, na.rm = TRUE), .groups = "drop") %>%
  arrange(desc(total)) %>%
  slice_head(n = 6) %>%
  ggplot(aes(x = reorder(offence, total), y = total, fill = offence)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Top 6 offences (Q1 2023)",
    x = "Offence",
    y = "Total cases"
  )


```
---

# 请输入文本



---

# Crime Patterns Across Age Groups in UK Prisons (Q1 2023)

```{r, include=FALSE, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(forcats)
library(scales)
library(gt)
library(glue)
library(janitor)

adj <- read_csv("AdjudicationsQ12023.csv") |> clean_names()

adj_clean <- adj |>
  mutate(
    count = suppressWarnings(as.numeric(count)),
    age_group = as.character(age_group),
    offence   = as.character(offence)
  ) |>
  filter(!is.na(age_group), !is.na(offence), !is.na(count), count > 0)

age_order <- c("15 - 17","18 - 20","21 - 24","25 - 29","30 - 39",
               "40 - 49","50 - 59","60 - 69","70 and over")
adj_clean <- adj_clean |>
  mutate(age_group = fct_relevel(age_group, age_order, after = 0))

age_offence_counts <- adj_clean |>
  group_by(age_group, offence) |>
  summarise(total = sum(count), .groups = "drop")

age_totals <- age_offence_counts |>
  group_by(age_group) |>
  summarise(age_total = sum(total), .groups = "drop")

age_offence_share <- age_offence_counts |>
  left_join(age_totals, by = "age_group") |>
  mutate(pct = total / age_total)

p_counts <- age_offence_counts |>
  ggplot(aes(x = total, y = age_group, fill = offence)) +
  geom_col() +
  geom_text(
    data = age_totals,
    aes(x = age_total, y = age_group, label = comma(age_total)),
    nudge_x = max(age_totals$age_total, na.rm = TRUE) * 0.02, 
    inherit.aes = FALSE, size = 3
  ) +
  labs(
    title = "Adjudications by Age Group and Offence (Q1 2023)",
    x = "Total Cases",
    y = "Age Group",
    fill = "Offence"
  ) +
  theme_minimal(base_size = 12)

p_share_labels <- age_offence_share |>
  mutate(lbl = ifelse(pct >= 0.05, percent(pct, accuracy = 1), "")) |>
  ggplot(aes(x = pct, y = age_group, fill = offence)) +
  geom_col() +
  geom_text(
    aes(label = lbl),
    position = position_stack(vjust = 0.5),
    size = 3, color = "white"
  ) +
  scale_x_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Composition of Offence Types within Each Age Group (Q1 2023)",
    x = "Share within Age Group",
    y = "Age Group",
    fill = "Offence"
  ) +
  theme_minimal(base_size = 12)
```

---

# Crime Patterns Across Age Groups in UK Prisons (Q1 2023)

```{r, echo=FALSE, fig.align='center', out.width="60%"}
p_share_labels
```


---

# Plots

```{r recode-species, echo = FALSE}
# In this chunk I'm doing a bunch of analysis that I don't want to present 
# in my slides. But I need the resulting data frame for a plot I want to present.
iris_modified <- iris %>%
  mutate(Species = fct_other(Species, keep = "setosa"))
```

```{r plot-iris, echo = FALSE}
# Code hidden with echo = FALSE
# Uses modified iris dataset from previous chunk
# Play around with height and width until you're happy with the look
ggplot(data = iris_modified, mapping = aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() + 
  theme_minimal() # theme options: https://ggplot2.tidyverse.org/reference/ggtheme.html
```

---

## Plot and text

.pull-left[
- Some text
- goes here
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger
ggplot(penguins, aes(x = bill_length_mm, y = species, color = species)) +
  geom_boxplot() +
  theme_minimal()
```
]

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r iris-table, echo = FALSE}
kable(head(iris), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "55%", fig.align = "center", fig.cap = "Image credit: Photo by Jörg Angeli on Unsplash."}
include_graphics("img/edinburgh-castle.jpg")
```

Or you can also include a full page image. See next slide.

---


class: inverse, center, middle
background-image: url(img/edinburgh-castle.jpg)
background-size: contain
---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

# Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcome to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
